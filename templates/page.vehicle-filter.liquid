<div class="vehicle-filter-form">
  <form action="/search" method="get" id="vehicle-filter-form">
    <!-- Access vehicle metafields -->
    {% assign vehicleYears = shop.metaobjects.vehicle_years.values %}

    <!-- Create Make dropdown -->
    <label for="make">Make:</label>
    <select name="make" id="make">
      <option value="">Select Make</option>
      {% for vehicleYear in vehicleYears %}
        <option values="{{ vehicleYear.make.value }}">{{ vehicleYear.make.value }}</option>
      {% endfor %}
    </select>

    <!-- Year Dropdown -->
    <label for="year">Year:</label>
    <select name="year" id="year" disabled>
      <option value="">Select Year</option>
      <!-- Options will be added dynamically -->
    </select>

    <!-- Model Dropdown -->
    <label for="model">Model:</label>
    <select name="model" id="model" disabled>
      <option value="">Select Model</option>
      <!-- Options will be added dynamically -->
    </select>

    <input class="button button-primary" type="submit" value="Show all parts">
  </form>
</div>

<script type="application/javascript">
  // Store the vehicle data for use in JavaScript
  var vehicleYearsData = {{ vehicleYears | json }};
</script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
      var makeSelect = document.getElementById('make');
      var yearSelect = document.getElementById('year');
      var modelSelect = document.getElementById('model');

      makeSelect.onchange = function() {
          // Clear previous options
          yearSelect.innerHTML = '<option value="">Select Year</option>';
          modelSelect.innerHTML = '<option value="">Select Model</option>';

          var selectedMake = makeSelect.value;
          var selectedVehicleYear = vehicleYearsData.find(v => v.make == selectedMake);
          var startYear = parseInt(selectedVehicleYear.min_year);
          var endYear = parseInt(selectedVehicleYear.max_year);

          for(var i=startYear; i<=endYear; i++) {
            var option = document.createElement('option');
              option.value = i;
              option.textContent = i;
              yearSelect.appendChild(option);
          }
        
          yearSelect.disabled = false;
      };

      yearSelect.onchange = function() {
          // Clear previous options
          modelSelect.innerHTML = '<option value="">Select Model</option>';
        
          var selectedMake = makeSelect.value;
          var selectedYear = yearSelect.value;
          var models = [];
{% assign vehicleMakeYears = shop.metaobjects.vehicle.values | display_name: selectedMake + " " + seletedYear%}        
{% paginate vehicleMakeYears by 50 %}
  {% for vehicle in shop.metaobjects.vehicle.values %}
    var option = document.createElement('option');
              option.value = model;
              option.textContent = model;
              modelSelect.appendChild(option);
    specialLocations[{{ forloop.index0 }}] = {
      "name" :  "{{location.name}}",
      "address" :  "{{location.address}}",
      "city" :  "{{location.city}}",
      "state" :  "{{location.state}}",
      "postal_code" :  "{{location.postal_code}}",
      "country" :  "{{location.country}}"
    }
  {% endfor %}
{% endpaginate %}
        
          // Filter vehiclesData to get models for the selected make and year
          /*
          vehiclesData.forEach(function(vehicle) {
              if (vehicle.make === makeSelect.value && vehicle.year === selectedYear && !models.includes(vehicle.model)) {
                  models.push(vehicle.model);
              }
          });

          // Populate model dropdown
          models.forEach(function(model) {
              var option = document.createElement('option');
              option.value = model;
              option.textContent = model;
              modelSelect.appendChild(option);
          });
          */
          modelSelect.disabled = false;
      };
  });

  document.getElementById('vehicle-filter-form').addEventListener('submit', function(e) {
    e.preventDefault();

    var make = document.getElementById('make').value;
    var model = document.getElementById('model').value;
    var year = document.getElementById('year').value;
    var baseUrl = "https://arashi-motorcycle.myshopify.com/collections/all";

    var filterUrl = `${baseUrl}?sort_by=best-selling&filter.p.m.custom.make=${make}&filter.p.m.custom.year2=${year}&filter.p.m.custom.model=${model}`;
    window.location.href = filterUrl;
});
</script>
